<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<style type="text/css">
		body, 
		html,
		#allmap {
			width: 100%;
			height: 100%;
			overflow: hidden;
			margin:0;
			font-family:"微软雅黑";
		}
		.info {
			z-index: 999;
			width: auto;
			min-width: 22rem;
			padding: .75rem 1.25rem;
			margin-left: 1.25rem;
			position: fixed;
			top: 1rem;
			background-color: #fff;
			border-radius: .25rem;
			font-size: 14px;
			color: #666;
			box-shadow: 0 2px 6px 0 rgba(27, 142, 236, 0.5);
		}
	</style>
	<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=4nDEx9VDbvFUecclhXgBZSxG3pxpQQ7f"></script>
	<title>地图展示</title>
</head>
<body>
	<div class = "info">
	(1) 单击地图或标记点，可标点与连线</br>
	(2) 双击标记点，可获取该点经纬度</br>
	(3) 右击地图，可删除所有标记点与路径
	</div>
	<div id="allmap"></div>
</body>
</html>
<!-- <script src="baiduTilesInfo.js"></script>  -->
<script src="qwebchannel.js"></script>
<script type="text/javascript">
	// 百度地图API功能
	var map = new BMap.Map("allmap", {enableMapClick:false});// 创建Map实例，关闭底图可点功能
	map.centerAndZoom(new BMap.Point(120.631275,30.106734), 19);  // 初始化地图,设置中心点坐标和地图级别
	//****添加缩放按钮
	var top_left_control = new BMap.ScaleControl({anchor: BMAP_ANCHOR_BOTTOM_LEFT});// 左上角，添加比例尺
	map.addControl(top_left_control);  

	// 添加定位控件
	var geolocationControl = new BMap.GeolocationControl({anchor: BMAP_ANCHOR_BOTTOM_RIGHT});
	geolocationControl.addEventListener("locationSuccess", function(e){
    // 定位成功事件
		var address = '';
		address += e.addressComponent.province;
		address += e.addressComponent.city;
		address += e.addressComponent.district;
		address += e.addressComponent.street;
		address += e.addressComponent.streetNumber;
		alert("当前定位地址为：" + address);
	});
    // 定位失败事件
	geolocationControl.addEventListener("locationError",function(e){alert(e.message);});
  	map.addControl(geolocationControl);
      
	//添加地图类型控件
	map.addControl(new BMap.MapTypeControl({
		mapTypes:[
            BMAP_NORMAL_MAP,
            BMAP_HYBRID_MAP
        ]}));	  
	map.setCurrentCity("绍兴");          // 设置地图显示的城市 此项是必须设置的
	map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放// 添加点
	// 记录点的数组
	var pointArr = [];
	var lastpoint = new BMap.Marker(new BMap.Point(0, 0));
	var index = 0;
	// 添加事件      
	map.addEventListener("click",function(e){  
		if(e.overlay){

        }else{
			// 获取单击点的位置(经度，纬度)
			var p = new BMap.Point(e.point.lng, e.point.lat); 
			// 创建一个标记
			var m = new BMap.Marker(p); 
			// 添加到数组组件
			pointArr.push(m);
			// 显示标记
			map.addOverlay(m); 
			pointArr[index].setTitle(index);

			if(index > 0)
			{
				var polyline = new BMap.Polyline([
					p,lastpoint.getPosition()
				], {
					strokeColor: 'blue',
					strokeWeight: 5,
					strokeOpacity: 1
				});
				map.addOverlay(polyline);
			}
			
			pointArr[index].addEventListener("dblclick",function(){
				// 获取单击点的位置(经度，纬度)
				// var p = new BMap.Point(e.point.lng, e.point.lat); 
				var nowpoint = this.getPosition();
				alert("该点经纬度为:"+nowpoint.lng+","+nowpoint.lat);
			});
			pointArr[index].addEventListener("click",function(){
				if(this.getPosition() != lastpoint.getPosition())
				{
					var polyline = new BMap.Polyline([
						this.getPosition(),
						lastpoint.getPosition()
					], {
						strokeColor: 'blue',
						strokeWeight: 5,
						strokeOpacity: 1
					});
					map.addOverlay(polyline);
					lastpoint = this;
				}
				else
				{
					alert("标点相同");
				}
			});
			lastpoint = m;
			index++;
        }     
	});
	map.addEventListener("rightclick",function(e){  
		if(e.overlay){

        }else{
			map.clearOverlays();
			pointArr = [];
			index = 0;
        }     
	});

</script>
